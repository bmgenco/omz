---
title: "figure2_new"
author: "Brandon M. Genco"
date: "10/3/2022"
output: html_document
---

# Packages, Directories

## dynamic directories

```{r setup}
rm(list=ls())
# relative directories
robj<-"r_objects"
fig<-"../../figures"
gis_data<-"../../data/gis_data"
data_d<-"../../data/2018_data"
# data_d<-"../../data"
ocean_color<-"../../data/ocean_color_bud"
bathy_d<-"../../data/bathy" # edit this


# old NC files
aqua_directory<-"../../data/ocean_color_bud/aqua"
terra_directory<-"../../data/ocean_color_bud/terra"
viirs_directory<-"../../data/ocean_color_bud/terra"

#absolute directory
drop_img<-"/home/brandon/Dropbox/MERCED/dissertation/presentations/images"

knitr::opts_chunk$set(echo =FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

## Load Packages
* Change 'packages' vector accordingly
* change font type
* to do trim uneeded package

```{r}
wd<-getwd()
f.ipak <- function(pkg){
  
  # loads packages, quietly, given by a vector of package names e.g., pkg<-c("ggplot", "tidyverse")
  # will install  packages listed , and their dependencies, if needed.
  
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg))
    install.packages(new.pkg, dependencies = TRUE, quiet=T, verbose = F)
  sapply(pkg, require, character.only = TRUE, quietly = FALSE, warn.conflicts=F)
}
packages<-c("stars", "gridExtra", "cowplot", "sf", "ggspatial","stringr","sp", "rgdal",  "rgeos", "raster","readr" ,"tidyverse", "ggplot2", "lubridate",  "ggthemes", "data.table", "reshape2", "patchwork", "RColorBrewer", "marmap", "extrafont", "oce", "ncdf4", "raster", "RStoolbox", "cmocean", "metR",  "ggimage", "scales")  # set packages here

# " grImport2",

f.ipak(packages)
rm(packages, f.ipak)
print(paste0("Current Working Directory is ", getwd()))

```

# data

## aqau, terra, viirs combined
* produces combination of aqau and terra chla
* change directory by computer, improve here
```{r}

#### combining aqau terra, and viirs ####

f.tmp1<-function(x){
  y<-nc_open(x)
  chl<-ncvar_get(y, 'chlor_a')
  lon<-ncvar_get(y, 'lon')
  lat<-ncvar_get(y, 'lat')
  rownames(chl)<-lon
  colnames(chl)<-lat
  nc_close(y)
  rm(y)
  x<-chl
  return(x)
}
f.tmp2<-function(x){
  y<-nc_open(x)

  
  end<-ncatt_get(y, attname = 'time_coverage_end', varid = 0, verbose=F)
  end<-end$value
  end<-ymd_hms(end)
  end<-with_tz(end, tz="US/Mountain")
  # time<-c(start, end, (end-start))
  day<-day(end)
  nc_close(y)
  # rm(y, start, end)
  rm(y, end)
  
  return(as.character(day))
  
  
  lon<-ncvar_get(y, 'lon')
  lat<-ncvar_get(y, 'lat')
  rownames(chl)<-lon
  colnames(chl)<-lat
  nc_close(y)
  rm(y)
  x<-chl
  return(x)
}

# aqua 
setwd(wd)
setwd(aqua_directory)
files<-list.files()

a<-lapply(files, f.tmp1)
dates<-lapply(files, f.tmp2)
names(a)<-as.character(dates)
rm(files, directory, dates)

#terra
setwd(wd)
setwd(terra_directory)
files<-list.files()

t<-lapply(files, f.tmp1)
dates<-lapply(files, f.tmp2)
names(t)<-as.character(dates)
rm(files, directory, dates)

lon<-as.numeric(rownames(a[[1]]))
lat<-as.numeric(colnames(a[[1]]))


#viirs
setwd(wd)
setwd(viirs_directory)
files<-list.files()

v<-lapply(files, f.tmp1)
dates<-lapply(files, f.tmp2)
names(v)<-as.character(dates)
rm(files, directory, dates)


combined<-vector(mode="list", length=length(a))
for(i in 1:length(combined)){
combined[[i]]<-(a[[i]]+t[[i]]+v[[i]])/3
  }

for(i in 1:length(combined)){
  combined[[i]]<-ifelse(is.na(combined[[i]]),(a[[i]]+t[[i]])/2,combined[[i]])
}

for(i in 1:length(combined)){
  combined[[i]]<-ifelse(is.na(combined[[i]]),(a[[i]]+v[[i]])/2,combined[[i]])
}

for(i in 1:length(combined)){
  combined[[i]]<-ifelse(is.na(combined[[i]]),(t[[i]]+v[[i]])/2,combined[[i]])
}

for(i in 1:length(combined)){
  combined[[i]]<-ifelse(is.na(combined[[i]]),a[[i]],combined[[i]])
}

for(i in 1:length(combined)){
  combined[[i]]<-ifelse(is.na(combined[[i]]),t[[i]],combined[[i]])
}

for(i in 1:length(combined)){
  combined[[i]]<-ifelse(is.na(combined[[i]]),v[[i]],combined[[i]])
}

names(combined)<-names(a)
rm(a,t,v, i)
rm(f.tmp1, f.tmp2)
```

## geotiif objects 
 load list
commnetd out - make ggplot objects

* redo for new figures:
* even versu odd, can I slecte by date?
* IMPORTANT raster stack is a local directory pointer object 
```{r}

# directory<-paste(ocean_color, "/true_color/viirs", sep ="") #change to modis if nessecary 
setwd(wd)
setwd(ocean_color)
setwd("./true_color/viirs")
files<-list.files()

v_rgb<-lapply(files,stack)
#v_rgb<-lapply(v_rgb, ggRGB, r=1, g=2, b=3) 
rm(files)
```



## staion 3.5 circle
* add 200 km circle- 100km radi
https://stackoverflow.com/questions/34183049/plot-circle-with-a-certain-radius-around-point-on-a-map-in-ggplot2

```{r}
setwd(wd)
setwd(robj)


stations_positions_list<-readRDS("OC1806A_stations_positions_list.R")
st3.5<-stations_positions_list[[3]][4,cbind(2,3)]
rm(stations_positions_list)

st3.5<-sf::st_as_sf(st3.5, coords =c("longitude", "latitude"),  crs = "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0")
flat<-sf::st_transform(st3.5, "+proj=aeqd +lat_0=18.5005 +lon_0=-108.502" )
circle<-sf::st_buffer(flat, dist=100000)%>%sf::st_transform(., "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0") 
rm(flat, st3.5)


```

## eye positon Bud & Aletta
- custom csv
- edited for custom image of hurricane over Bud

```{r}

setwd(wd)
setwd(gis_data)
directory<-getwd()

eyes<-read_csv("aletta_bud_eye_position_visual.csv")


a<-filter(eyes, storm=="Aletta")  %>% st_as_sf(., coords=c("lon", "lat"))
st_crs(a)<-"+proj=longlat +datum=WGS84 +no_defs"

b<-filter(eyes, storm=="Bud")

b<-data.frame(day=b$day, lon=b$lon, lat=b$lat, image=paste0(directory, "/hurricane.png"))
b<-b%>% st_as_sf(., coords=c("lon", "lat"))

st_crs(b)<-"+proj=longlat +datum=WGS84 +no_defs"


```

# figure
## Functions

### plot functions
```{r}
f.fig2<-function(combined, v_rgb, i, t, l){
  t1<-combined[[i]]
  t2<-v_rgb[[i]]
  date<-paste0("June", " ", names(combined)[i])

  eye.a<-filter(a, day==as.numeric(names(combined[i])))%>% select(., geometry)
  # eye.b<-filter(a, day==as.numeric(names(combined[i]))) %>% select(., geometry)
  eye.b<-filter(b, day==as.numeric(names(combined[i]))) 

  lat<-as.numeric(row.names(t(t1)))
  lon<-as.numeric(colnames(t(t1)))
  
  t1<-raster(t(t1))

  extent(t1)<-extent(min(lon), max(lon), min(lat), max(lat))
  # extent(t1)<-extent(-120, -100, 10, 33.5)
  
  
  t1_ex<-extent(t1)
  t2_ex<-extent(t2)
  extent(t1)<-extent(t1_ex[1], t2_ex[2], t2_ex[3], t2_ex[4])
  extent(t2)<-extent(t1_ex[1], t2_ex[2], t2_ex[3], t2_ex[4])
  rm(t1_ex, t2_ex)
  
  
  t3<-resample(t1, t2)
  t3<-na.omit(t3)
  
  
  # new extent
  e<-extent(t1)
  h<-abs(e[4]-e[3])
  w<-abs(e[1]-e[2])

  left<-right -(w*zoom)
  top<-(h*zoom)+bottom
  new<-as(extent(left, right, bottom, top), 'SpatialPolygons') 
  crs(new)<-"+proj=longlat +datum=WGS84 +no_defs"
  
  t2<-crop(t2, new)
  t3<-crop(t3, new)
  
  st_crs(eye.b)<-st_crs(t3)
  # eye.b<-data.frame(lon=st_geometry(eye.b)[[1]][[1]], lat=st_geometry(eye.b)[[1]][[2]], image=eye.b$image)
  
  rm(t1)
  
  f1<- ggRGB(t2, r=1, g=2, b=3, ggObj = T) + ggtitle(date)+theme_bw() +
    theme(plot.title = element_text(hjust = 0.5))+
    theme(axis.line = element_line(colour = "black"),
          plot.margin = unit(c(t, 0, 0, l), "cm"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.border = element_blank(),
          #panel.background = element_rect(colour = "black", fill=NA, size=5),
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
          scale_y_continuous(expand = c(0, 0), breaks=lat_ticks)+
          scale_x_continuous(expand = c(0, 0), breaks=lon_ticks)
          

    
if (length(eye.b$geometry)>0) {
  
  eye.b<-data.frame(lon=st_geometry(eye.b)[[1]][[1]], lat=st_geometry(eye.b)[[1]][[2]], image=eye.b$image)
  
  f3<-f1+ggR(t3, geom_raster = TRUE, ggLayer=T) +
    theme(axis.line = element_line(colour = "black"),
          plot.margin = unit(c(t, 0, 0, 0, l), "cm"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(colour = "black", fill=NA, size=5),
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    scale_fill_gradientn(colors = custom_color, values=cuts, na.value=NA,limits=c(0,5), 
                         name=waiver(),breaks=labs)+
    guides(fill=guide_colourbar(title=bquote(title_two), barheight = 8)) +
    theme(legend.title =element_text(size=8), legend.text=element_text(size=6)) + 
    theme(text=element_text(family="Helvetica")) + theme(legend.position = "none") +
    geom_sf(data = circle, color = circle_color, alpha = 0, inherit.aes = FALSE)+
    geom_sf(data=eye.a, inherit.aes = FALSE, shape =aletta_symbol, col=aletta_color,  fill=aletta_color, size=aletta_size)+
    # geom_image(aes(x=lon, y=lat, image=image), data=eye.b, inherit.aes = FALSE, col=bud_color, size=bud_size,  by="width")+
    geom_image(aes(x=lon, y=lat, image=image), data=eye.b, inherit.aes = FALSE)+
    scale_size_identity()+
    coord_sf(xlim = c(left,right), ylim = c(bottom, top))
  
} else {
   f3<-f1+ggR(t3, geom_raster = TRUE, ggLayer=T) +
    theme(axis.line = element_line(colour = "black"),
          plot.margin = unit(c(t, 0, 0, 0, l), "cm"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(colour = "black", fill=NA, size=5),
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    scale_fill_gradientn(colors = custom_color, values=cuts, na.value=NA,limits=c(0,5), 
                         name=waiver(),breaks=labs)+
    guides(fill=guide_colourbar(title=bquote(title_two), barheight = 8)) +
    theme(legend.title =element_text(size=8), legend.text=element_text(size=6)) + 
    theme(text=element_text(family="Helvetica")) + theme(legend.position = "none") +
    geom_sf(data = circle, color = circle_color, alpha = 0, inherit.aes = FALSE)+
    geom_sf(data=eye.a, inherit.aes = FALSE, shape =aletta_symbol, col=aletta_color,  fill=aletta_color, size=aletta_size)+
    coord_sf(xlim = c(left,right), ylim = c(bottom, top))
  
  }
  
  

  
  return(f3)
}
f.fig2_no_y<-function(combined, v_rgb, i, t, l){
  t1<-combined[[i]]
  t2<-v_rgb[[i]]
  date<-paste0("June", " ", names(combined)[i])
  
  eye.a<-filter(a, day==as.numeric(names(combined[i]))) %>% select(., geometry)
  # eye.b<-filter(a, day==as.numeric(names(combined[i]))) %>% select(., geometry)
  eye.b<-filter(b, day==as.numeric(names(combined[i]))) 

  
  lat<-as.numeric(row.names(t(t1)))
  lon<-as.numeric(colnames(t(t1)))
  
  t1<-raster(t(t1))
  extent(t1)<-extent(min(lon), max(lon), min(lat), max(lat))
  # extent(t1)<-extent(-120, -100, 10, 33.5)
  
  t1_ex<-extent(t1)
  t2_ex<-extent(t2)
  extent(t1)<-extent(t1_ex[1], t2_ex[2], t2_ex[3], t2_ex[4])
  extent(t2)<-extent(t1_ex[1], t2_ex[2], t2_ex[3], t2_ex[4])
  rm(t1_ex, t2_ex)
  
  
  t3<-resample(t1, t2)
  t3<-na.omit(t3)
 
  # new extent
  e<-extent(t1)
  h<-abs(e[4]-e[3])
  w<-abs(e[1]-e[2])

  left<-right -(w*zoom)
  top<-(h*zoom)+bottom
  new<-as(extent(left, right, bottom, top), 'SpatialPolygons') 
  crs(new)<-"+proj=longlat +datum=WGS84 +no_defs"
  
  t2<-crop(t2, new)
  t3<-crop(t3, new)
  
  st_crs(eye.b)<-st_crs(t3)
  # eye.b<-data.frame(lon=st_geometry(eye.b)[[1]][[1]], lat=st_geometry(eye.b)[[1]][[2]], image=eye.b$image)
  

  rm(t1)
  
  f1<- ggRGB(t2, r=1, g=2, b=3, ggObj = T) + ggtitle(date)+theme_bw() +
    theme(plot.title = element_text(hjust = 0.5))+
    theme(axis.line = element_line(colour = "black"),
          plot.margin = unit(c(t, 0, 0, l), "cm"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.border = element_blank(),
          #panel.background = element_rect(colour = "black", fill=NA, size=5),
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
          scale_y_continuous(expand = c(0, 0), breaks=lat_ticks)+
          scale_x_continuous(expand = c(0, 0), breaks=lon_ticks)
          
 
  if (length(eye.b$geometry)>0) {
   
  eye.b<-data.frame(lon=st_geometry(eye.b)[[1]][[1]], lat=st_geometry(eye.b)[[1]][[2]], image=eye.b$image) 
   
  f3<-f1+ggR(t3, geom_raster = TRUE, ggLayer=T) +
    theme(axis.line = element_line(colour = "black"),
          plot.margin = unit(c(t, 0, 0, 0, l), "cm"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(colour = "black", fill=NA, size=5),
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    scale_fill_gradientn(colors = custom_color, values=cuts, na.value=NA,limits=c(0,5), 
                         name=waiver(),breaks=labs)+
    guides(fill=guide_colourbar(title=bquote(title_two), barheight = 8)) +
    theme(legend.title =element_text(size=8), legend.text=element_text(size=6)) + 
    theme(text=element_text(family="Helvetica")) + theme(legend.position = "none") +
    theme(axis.text.y=element_blank(), axis.ticks.y=element_blank())+
    geom_sf(data = circle, color = circle_color, alpha = 0, inherit.aes = FALSE)+
    geom_sf(data=eye.a, inherit.aes = FALSE, shape =aletta_symbol, col=aletta_color,  fill=aletta_color, size=aletta_size)+
    # geom_image(aes(x=lon, y=lat, image=image), data=eye.b, inherit.aes = FALSE, col=bud_color, size=bud_size, by="width")+
    geom_image(aes(x=lon, y=lat, image=image), data=eye.b, inherit.aes = FALSE)+
    scale_size_identity()+
    coord_sf(xlim = c(left,right), ylim = c(bottom, top))
    
} else {
   f3<-f1+ggR(t3, geom_raster = TRUE, ggLayer=T) +
    theme(axis.line = element_line(colour = "black"),
          plot.margin = unit(c(t, 0, 0, 0, l), "cm"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(colour = "black", fill=NA, size=5),
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    scale_fill_gradientn(colors = custom_color, values=cuts, na.value=NA,limits=c(0,5), 
                         name=waiver(),breaks=labs)+
    guides(fill=guide_colourbar(title=bquote(title_two), barheight = 8)) +
    theme(legend.title =element_text(size=8), legend.text=element_text(size=6)) + 
    theme(text=element_text(family="Helvetica")) + theme(legend.position = "none") +
    theme(axis.text.y=element_blank(), axis.ticks.y=element_blank())+
    geom_sf(data = circle, color = circle_color, alpha = 0, inherit.aes = FALSE)+
    geom_sf(data=eye.a, inherit.aes = FALSE, shape =aletta_symbol, col=aletta_color, fill=aletta_color, size=aletta_size)+
    coord_sf(xlim = c(left,right), ylim = c(bottom, top))
  }

        
  
  return(f3)
}
```

### legends
```{r}
f.fig2_legend<-function(combined, v_rgb, height, width, t,b,r,l, title.textsize, marks.textsize){
  t1<-combined[[1]]
  t2<-v_rgb[[1]]
  
  lat<-as.numeric(row.names(t(t1)))
  lon<-as.numeric(colnames(t(t1)))
  
  t1<-raster(t(t1))
  extent(t1)<-extent(min(lon), max(lon), min(lat), max(lat))
  # extent(t1)<-extent(-120, -100, 10, 33.5)
  
  t1_ex<-extent(t1)
  t2_ex<-extent(t2)
  extent(t1)<-extent(t1_ex[1], t2_ex[2], t2_ex[3], t2_ex[4])
  extent(t2)<-extent(t1_ex[1], t2_ex[2], t2_ex[3], t2_ex[4])
  rm(t1_ex, t2_ex)
  
  
  t3<-resample(t1, t2)
  t3<-na.omit(t3)
  
  # new extent
  e<-extent(t1)
  h<-abs(e[4]-e[3])
  w<-abs(e[1]-e[2])

  left<-right -(w*zoom)
  top<-(h*zoom)+bottom
  
  new<-as(extent(left, right, bottom, top), 'SpatialPolygons') 
  crs(new)<-"+proj=longlat +datum=WGS84 +no_defs"
  
  t3<-crop(t3, new)
  
  rm(t1)

  
  p<-ggplot()+ggR(t3, geom_raster = TRUE, ggLayer=T) +
    theme(axis.line = element_line(colour = "black"),
          plot.margin = unit(c(0, 0, 0, 0, 0), "cm"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(colour = "black", fill=NA, size=5),
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    scale_fill_gradientn(colors = custom_color, values=cuts, na.value=NA,limits=c(0,5), 
                         name=waiver(),breaks=labs)+
    guides(fill=guide_colourbar(title=title_two, barheight = height, barwidth = width)) +
    theme(legend.title =element_text(size=title.textsize), legend.text=element_text(size=marks.textsize)) + 
    theme(text=element_text(family="Helvetica"))
    # xlim(left, right) +ylim(bottom,top)
  
  legend <- get_legend(p + theme(legend.box.margin = margin(t, r, b, l)))
  rm(p, t3, t2) 
  return(legend)
} # l = legend margin left, b=barhieght (in cm ) of legend
```

## figure 2 and s5

select dates
 - zoomed in main figure. dates:
 4,   5, 9
 10, 11, 12
 14, 15, 16
 17, 21 ,23
 
-supplement fulkl resolution
 
6    7  8
13, 18, 19
20  22  24
25  26  27

 
```{r}

#Much of this should really be compressed into  a function...

start<-Sys.time()
rm(p, s.p)
# changing files will likely break folowin index
# plotting parameters

options(warn=-1)
plots<-vector(mode='list', length = length(combined))

cuts<-c(0, 0.01, 0.02, 0.04,  0.08,  0.1,  0.15, 0.2, 0.35, 0.5, 0.8, 0.9, 1, 2,3,4, 5)
n<-length(cuts)+1
custom_color<-rev(rainbow(n))
cuts<-rescale(cuts)
title_two<-expression(atop(textstyle("Chl a"), textstyle("mg m"^-3*"")))
labs<-c(0.1, .5, 1, 2 , 2.5, 5)
# bar_height<-25
bar_height<-22.70

# plotting colors & symbols + size
circle_color<-"#e41a1c"
# bud_color<-"#377eb8"
# aletta_color<-"#4daf4a"

bud_color<-"black"
# aletta_color<-"midnightblue"
aletta_color<-"black"
aletta_size<-2
bud_size<-4

# bud_symbol<-13
# aletta_symbol<-12

bud_symbol<-NULL
aletta_symbol<-25

lat_ticks<-seq(15,30, b=5)
lon_ticks<-c(-115, -110, -105)
 
# image extent
# combinded full:
# class      : Extent 
# xmin       : -122.4792 
# xmax       : -97.02084 
# ymin       : 5.520833 
# ymax       : 32.97917 


right<--104.7671
right<--100.8555
# shfit right to get Aletta

right<--101.8555

# bottom<-11.55
bottom<-12.5
# zoom<-.75
# right<--97.02084
# bottom<-5.520833

zoom<-.60
# zoom<-1

### Main figure select days ####

i<-which(names(combined)==4)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==10)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==14)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==17)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==5)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==9)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==11)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==12)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==15)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==16)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==21)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==23)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)


p<-(plots[[which(names(combined)==4)]]+ plots[[which(names(combined)==5)]]+plots[[which(names(combined)==9)]]+plots[[which(names(combined)==10)]]+plots[[which(names(combined)==11)]]+ plots[[which(names(combined)==12)]]+ plots[[which(names(combined)==14)]]+ plots[[which(names(combined)==15)]]+plots[[which(names(combined)==16)]]+plots[[which(names(combined)==17)]]+ plots[[which(names(combined)==21)]]+plots[[which(names(combined)==23)]]+plot_layout(ncol=3))

# legend<-f.fig2_legend(combined, v_rgb, height=bar_height, width=1, t=-390, b=0, r=0, l=-115,  title.textsize=10, marks.textsize=8)


### supplements  ####

right<--97.02084
bottom<-5.520833

zoom<-1
lat_ticks<-seq(10,30, b=5)
lon_ticks<-seq(-120, -100, b=10)


i<-which(names(combined)==6)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==13)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==20)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==25)
plots[[i]]<-f.fig2(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==7)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==8)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==18)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==19)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==22)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==24)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==26)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)
i<-which(names(combined)==27)
plots[[i]]<-f.fig2_no_y(combined, v_rgb, i=i, t=0, l=0)

s.p<-(plots[[which(names(combined)==6)]]+ plots[[which(names(combined)==7)]]+plots[[which(names(combined)==8)]]+plots[[which(names(combined)==13)]]+plots[[which(names(combined)==18)]]+ plots[[which(names(combined)==19)]]+ plots[[which(names(combined)==20)]]+ plots[[which(names(combined)==22)]]+plots[[which(names(combined)==24)]]+plots[[which(names(combined)==25)]]+ plots[[which(names(combined)==26)]]+plots[[which(names(combined)==27)]]+plot_layout(ncol=3))
rm(plots)


# legend.sup<-f.fig2_legend(combined, v_rgb, height=bar_height, width=1, t=-390, b=0, r=0, l=-115,  title.textsize=10, marks.textsize=8)

## supplementray figure

end<-Sys.time()
elapsed<-end-start
print(elapsed)

# rm( left, top,  labs, lat, lon, circle_color, custom_color, aletta_color, aletta_symbol, bud_color, bud_symbol, lat_ticks, lon_ticks, i, cuts, elapsed, start, end, zoom, title_two, n, t1, t2, t2, t1_ex, t2_ex, eye.a, eye.b)

# rm(right, left, top, bottom, labs, lat, lon, circle_color, custom_color, aletta_color, aletta_symbol, bud_color, bud_symbol, lat_ticks, lon_ticks, i, cuts, elapsed, start, end, zoom, title_two, n, t1, t2, t2, t1_ex, t2_ex, eye.a, eye.b)


# t

gc()

```

## legends
```{r}
# t<--390

t=5
legend<-f.fig2_legend(combined, v_rgb, height=bar_height, width=1, t=t, b=0, r=0, l=-115,  title.textsize=10, marks.textsize=8)
t=-1.5
legend_n<-f.fig2_legend_eyes(combined, v_rgb, height=bar_height, width=1, t=t, b=0, r=0, l=-115, day=10, title.textsize=10, marks.textsize=8)
```

## temp svae plotting objects

```{r}
# setwd(wd)
# setwd(robj)
# p<-readRDS("figure_2_plotlist.R")
# s.p<-readRDS("sup_figure_5_plotlist.R")
# saveRDS(p, "figure_2_plotlist.RData")
# saveRDS(s.p, "sup_figure_5_plotlist.RData")

```



# save plots

```{r}
setwd(wd)
setwd(fig)

# pdf("figure_two.pdf", height=11 , width =8.5)
# plot_grid(p, legend, ncol=2, rel_widths=c(14,1), align="h")
# dev.off()
# 
# 
# pdf("figure_s5.pdf", height=11 , width =8.5)
# plot_grid(s.p, legend, ncol=2, rel_widths=c(14,1), align="h")
# dev.off()

legends<-plot_grid(legend, legend_n, ncol=1)
pdf("figure_two.pdf", height=11 , width =8.5)
plot_grid(p, legends, ncol=2, rel_widths=c(14,1), align="h")
dev.off()



```