---
title: "ch2__s3_individual"
output: html_document
date: '2023-09-25'
---
 

# Setup
## Directories and defaults

Ideally uses proj file for relative directories
see: https://yihui.org/knitr/options/

Directory structure  used in this analysis:

~/omz/wd
-- /output
-- /data
-- /figures
-- /r_wd

~/omz/wd/r_wd
-- /Index
-- /Profiles
-- /r_objects
-- /r_scripts

```{r setup}
rm(list=ls())

r_scriptwd<-getwd()
wd<-substring(r_scriptwd,1,nchar(r_scriptwd) -10) # hardcoding replace here
knitr::opts_knit$set(root.dir = wd)

# relative directories
robj<-"r_objects"
fig<-"../../figures"
gis_data<-"../../data/gis_data"
output<-"../../output"
data_d<-"../../data"

# ocean_color<-"../../data/ocean_color_bud"
# bathy_d<-"../../data/bathy" # edit this

knitr::opts_chunk$set(echo =FALSE)
#knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

## Packages
Installed custom hurdat package using r markdown menu
* download  tar from archive as no longer maintained on cran repository
* https://cran.r-project.org/src/contrib/Archive/HURDAT/
+ include as git submodule instead

```{r}
wd<-getwd()
f.ipak <- function(pkg){
  # loads packages, quietly, given by a vector of package names e.g., pkg<-c("ggplot", "tidyverse")
  # will install  packages listed , and their dependencies, if needed.
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg))
    install.packages(new.pkg, dependencies = TRUE, quiet=T, verbose = F)
  sapply(pkg, require, character.only = TRUE, quietly = FALSE, warn.conflicts=F)
}
packages<-c("plyr","sp", "rgdal",  "rgeos", "raster", "readr", "tidyverse", "lubridate",  "ggthemes",  "sf", "cmocean", "ncdf4", "RNetCDF",  "plot3D", "tidync", "devtools", "stars", "ncmeta", "maps", "oce", "data.table", "fasterize", "RStoolbox", "scales", "purrr", "HURDAT" , "gsw", "R.utils","Matrix")
# "HURDAT",
f.ipak(packages)
# lapply(packages, require, character.only = TRUE)
# rm(f.ipak, packages)
print(paste0("Current Working Directory is ", getwd()))
```

## Load submodule for bio-argo floats
* using newer OneArgo-R
* https://github.com/NOAA-PMEL/OneArgo-R

```{r}
# setwd(wd)

# main functions
path<-"r_scripts/submodules/OneArgo-R/"

source(paste0(path, "get_lon_lat_time.R"))
source(paste0(path, "initialize_argo.R"))
source(paste0(path, "load_float_data.R"))
source(paste0(path, "select_profiles.R"))
source(paste0(path, "show_profiles.R"))
source(paste0(path, "show_sections.R"))
source(paste0(path, "show_time_series.R"))
source(paste0(path, "show_trajectories.R"))

# auxilary functions
path = "r_scripts/submodules/OneArgo-R/auxil/"
file_path<-paste0(wd,"/",path)
files<-list.files(file_path, pattern ="\\.R$")

for(i in 1:length(files)){
  source(paste0(path, files[i]))
}

# packages<-c("gsw", "R.utils","Matrix")
# f.ipak(packages)
# 
rm(path, file_path, files)

####   this doesn't work... ####
# perhaps not functions R files breaks it
#file_path<-paste0(wd, "/", path)

#files<-list.files(file_path, pattern ="\\.R")
# for(i in 1:length(files)){
#   source(paste0(path, files[i]), local=F)
# }

```

# functions
```{r}
# select storm by key from hurdat objects

f.select_name<-function(x, key_id){
x<-x$tc
x<-x[which(names(x) == key_id)]
return(x)
}
```

# data


```{r}
data<-readRDS("r_objects/ch2_seq_1_data.R")
```

## doxy floast
```{r}
 ep_doxy_floats<-readRDS("r_objects/ep_doxy_floats.rds")
```


## natural earth coastlines
source : https://www.naturalearthdata.com/downloads/10m-physical-vectors/10m-coastline/
version: 4.1.0
```{r}
setwd(gis_data)
# save shape files in named directory
coastline<-st_read("./ne_50m_land/ne_50m_land.shp") 

```


# select items from data
#
```{r}

function_variables<-data$function_variables
# hurdat objects
h<-data$selected_zone_hurdat$h
h.pts<-data$selected_zone_hurdat$h.pts
h.tracks<-data$selected_zone_hurdat$h.tracks

# match_up

list.100<-data$tc_search_radi_profiles$km_100
list.200<-data$tc_search_radi_profiles$km_200
list.500<-data$tc_search_radi_profiles$km_500

# temp for memory space
# rm(data)

```

# slect indviudla tc

- TC 1 FLECIA EP082009
- TC  Norma "EP172017"
- TC "GENEVIEVE" "EP122020"
- TC Darby EP052022
- Tc Elida EP092020
-TC Howard? EP092022

```{r}
key_id<-"EP122020"
p<-f.select_name(x=list.500, key_id)
tc<-filter(h, Key == key_id )
print(tc$Name[1])


```

prof

```{r}
p1<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[1])
p2<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[2])
p3<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[3])
p4<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[4])
p5<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[5])


```

```{r}
show_sections(float_ids = as.numeric(p$EP082009$float[1]))
```


```{r}
show_sections()
```

