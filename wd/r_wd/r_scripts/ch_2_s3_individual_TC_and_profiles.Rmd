---
title: "ch2__s3_individual"
output: html_document
date: '2023-09-25'
---
 

# Setup
## Directories and defaults

Ideally uses proj file for relative directories
see: https://yihui.org/knitr/options/

Directory structure  used in this analysis:

~/omz/wd
-- /output
-- /data
-- /figures
-- /r_wd

~/omz/wd/r_wd
-- /Index
-- /Profiles
-- /r_objects
-- /r_scripts

```{r setup}
rm(list=ls())

r_scriptwd<-getwd()
wd<-substring(r_scriptwd,1,nchar(r_scriptwd) -10) # hardcoding replace here
knitr::opts_knit$set(root.dir = wd)

# relative directories
robj<-"r_objects"
fig<-"../../figures"
gis_data<-"../../data/gis_data"
output<-"../../output"
data_d<-"../../data"
my_functions<-"r_scripts/submodules/BG_functions/"
# ocean_color<-"../../data/ocean_color_bud"
# bathy_d<-"../../data/bathy" # edit this

knitr::opts_chunk$set(echo =FALSE)
#knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```


# source

```{r}

source(paste0(my_functions, "ch2_functions.R"))
source(paste0(my_functions, "ch2_header.R"))

f.ipak(packages)
## get metadata ##
# initialize_argo()


```



# data

```{r}
data<-readRDS("r_objects/ch2_seq_1_data.R")

h<-data$selected_zone_hurdat$h
function_variables<-data$function_variables
# hurdat 
h.pts<-data$selected_zone_hurdat$h.pts
h.tracks<-data$selected_zone_hurdat$h.tracks

list.100<-data$tc_search_radi_profiles$km_100
list.200<-data$tc_search_radi_profiles$km_200
list.500<-data$tc_search_radi_profiles$km_500

# rm(data)
```


## natural earth coastlines
source : https://www.naturalearthdata.com/downloads/10m-physical-vectors/10m-coastline/
version: 4.1.0
```{r}
setwd(gis_data)
# save shape files in named directory
coastline<-st_read("./ne_50m_land/ne_50m_land.shp") 

cl<-st_crop(coastline, xmin=-170, ymin=-20, xmax=-80, ymax=40)
m.coast <-ggplot()+ geom_sf(data =cl, size=0.5)+ theme(axis.title.x=element_blank(), axis.title.y=element_blank())+theme_bw()+ theme(text = element_text(size =12))
```

#


# olaf ggplots

```{r}
key_id<-"EP152021"
tc.pts<-f.single_storm_h.pts(key_id = key_id, h.pts)
conv<-1.94384 # convert to m/s
tc.pts$max_sustained_wind_m_s<-tc.pts$Wind/conv
tc.track<-filter(h.tracks, Key == key_id)
tc.p<-list.500$tc$EP152021 # can make a function

c3a<-coord_sf(xlim = c(-116, -105), ylim = c(16, 26))

```


GG plot itmes
```{r}

#image defaluts

# figure margins
# t=0.5
t=0
# r=0
r=0.5
l=0
b=.25

width=1
height=14

marks.textsize=2
title.textsize=8
lp<-"right"

n<-30
custom_color<-cmocean('matter', version="2.0")(n)

title_two<-expression(textstyle("Wind m s"^-1*""))
l1<-scale_fill_gradientn(colors = custom_color ,  na.value=NA, name=waiver()) 
l2<-guides(fill=guide_colourbar(title=title_two, barheight = height, 
                                barwidth = width, title.position = "top",  
                                # title.hjust = 0.5,
                                title.theme = element_text(size=title.textsize)), 
                                legend.text=element_text(size=marks.textsize))



tc_wind<-geom_sf(aes(fill=max_sustained_wind_m_s), data=tc.pts,  shape=21, size=3, color="white")


th1<-theme(text=element_text(family="Helvetica"))+ theme(legend.position=lp, plot.background = element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.title.x=element_blank(), axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5), plot.margin = unit(c(t, r, b, l), "cm"), legend.box.margin=margin(-15,-10,-10,-10))

cut_off<-coord_sf(xlim = c(-113, -105.5), ylim = c(17, 24))

```

```{r}
tc.p.sf<-st_as_sf(tc.p)
p_labels<-geom_sf_text(aes(label = day_difference), data=tc.p.sf , size = 3,  vjust=1.5, hjust =1.5)
```

```{r}
m.map<-m.coast+geom_sf(data=tc.track)+tc_wind+th1+l1+l2+cut_off
m.map1<-m.map+geom_sf(data=tc.p.sf)+p_labels+cut_off

```


# genieve ggplots

```{r}
key_id<-"EP122020"
tc.pts<-f.single_storm_h.pts(key_id = key_id, h.pts)
conv<-1.94384 # convert to m/s
tc.pts$max_sustained_wind_m_s<-tc.pts$Wind/conv
tc.track<-filter(h.tracks, Key == key_id)
tc.p<-list.500$tc$EP122020 # can make a function

tc.p.sf<-st_as_sf(tc.p)
p_labels<-geom_sf_text(aes(label = day_difference), data=tc.p.sf , size = 3,  vjust=1.5, hjust =1.5)


# c3a<-coord_sf(xlim = c(-116, -105), ylim = c(16, 26))
tc_wind<-geom_sf(aes(fill=max_sustained_wind_m_s), data=tc.pts,  shape=21, size=3, color="white")
cut_off<-coord_sf(xlim = c(-113, -105.5), ylim = c(14, 19))

l1<-scale_fill_gradientn(colors = custom_color ,  na.value=NA, name=waiver()) 
l2<-guides(fill=guide_colourbar(title=title_two, barheight = height, 
                                barwidth = width, title.position = "top",  
                                # title.hjust = 0.5,
                                title.theme = element_text(size=title.textsize)), 
                                legend.text=element_text(size=marks.textsize))



cut_off<-coord_sf(xlim = c(-113, -105.5), ylim = c(14, 19))

m.map<-m.coast+geom_sf(data=tc.track)+tc_wind+th1+l1+l2+cut_off
m.map1<-m.map+geom_sf(data=tc.p.sf)+p_labels+cut_off

```

# mysterious kay
KAy all
```{r}
key_id<-"EP122022"
tc.pts<-f.single_storm_h.pts(key_id = key_id, h.pts)
conv<-1.94384 # convert to m/s
tc.pts$max_sustained_wind_m_s<-tc.pts$Wind/conv
tc.track<-filter(h.tracks, Key == key_id)
tc.p<-list.500$tc$EP122022 # can make a function


tc.p.sf<-st_as_sf(tc.p)
p_labels<-geom_sf_text(aes(label = day_difference), data=tc.p.sf , size = 3,  vjust=1.5, hjust =1.5)


# c3a<-coord_sf(xlim = c(-116, -105), ylim = c(16, 26))
tc_wind<-geom_sf(aes(fill=max_sustained_wind_m_s), data=tc.pts,  shape=21, size=3, color="white")
cut_off<-coord_sf(xlim = c(-113, -105.5), ylim = c(14, 19))

l1<-scale_fill_gradientn(colors = custom_color ,  na.value=NA, name=waiver()) 
l2<-guides(fill=guide_colourbar(title=title_two, barheight = height, 
                                barwidth = width, title.position = "top",  
                                # title.hjust = 0.5,
                                title.theme = element_text(size=title.textsize)), 
                                legend.text=element_text(size=marks.textsize))



cut_off<-coord_sf(xlim = c(-128, -99), ylim = c(9, 35))

m.map<-m.coast+geom_sf(data=tc.track)+tc_wind+th1+l1+l2+cut_off
m.map1<-m.map+geom_sf(data=tc.p.sf)+p_labels+cut_off


```

KAy centre strong TC



```{r}
key_id<-"EP122022"
tc.pts<-f.single_storm_h.pts(key_id = key_id, h.pts)
conv<-1.94384 # convert to m/s
tc.pts$max_sustained_wind_m_s<-tc.pts$Wind/conv
tc.track<-filter(h.tracks, Key == key_id)
tc.p<-list.100$hu$EP122022 # can make a function



tc.p.sf<-st_as_sf(tc.p)
p_labels<-geom_sf_text(aes(label = day_difference), data=tc.p.sf , size = 3,  vjust=1.5, hjust =1.5)


# c3a<-coord_sf(xlim = c(-116, -105), ylim = c(16, 26))
tc_wind<-geom_sf(aes(fill=max_sustained_wind_m_s), data=tc.pts,  shape=21, size=3, color="white")
cut_off<-coord_sf(xlim = c(-113, -105.5), ylim = c(14, 19))

l1<-scale_fill_gradientn(colors = custom_color ,  na.value=NA, name=waiver()) 
l2<-guides(fill=guide_colourbar(title=title_two, barheight = height, 
                                barwidth = width, title.position = "top",  
                                # title.hjust = 0.5,
                                title.theme = element_text(size=title.textsize)), 
                                legend.text=element_text(size=marks.textsize))



cut_off<-coord_sf(xlim = c(-113, -110), ylim = c(18, 21))

m.map<-m.coast+geom_sf(data=tc.track)+tc_wind+th1+l1+l2+cut_off
m.map1<-m.map+geom_sf(data=tc.p.sf)+p_labels+cut_off


```




# slect indviudla tc

- TC 1 FLECIA EP082009
- TC  Norma "EP172017"
- TC "GENEVIEVE" "EP122020"
- TC Darby EP052022
- Tc Elida EP092020
-TC Howard? EP092022

```{r}
key_id<-"EP122020"
p<-f.select_name(x=list.500, key_id)
tc<-filter(h, Key == key_id )
print(tc$Name[1])


```

prof

```{r}
p1<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[1])
p2<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[2])
p3<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[3])
p4<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[4])
p5<-show_profiles(float_ids = p$EP082009$float[1], float_profs = p$EP082009$profile[5])


```

```{r}
show_sections(float_ids = as.numeric(p$EP082009$float[1]))
```


```{r}
show_sections()
```

