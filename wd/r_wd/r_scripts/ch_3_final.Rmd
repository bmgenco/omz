---
title: "ch _3_submit"
output: html_document
date: '2023-11-14'
---


# Setup
## Directories and defaults

Ideally uses proj file for relative directories
see: https://yihui.org/knitr/options/

Directory structure  used in this analysis:

~/omz/wd
-- /output
-- /data
-- /figures
-- /r_wd
st_crs(temp)<-st_crs(ti)

~/omz/wd/r_wd
-- /Index
-- /Profiles
-- /r_objects
-- /r_scripts

```{r setup}
rm(list=ls())

r_scriptwd<-getwd()
wd<-substring(r_scriptwd,1,nchar(r_scriptwd) -10) # hardcoding replace here
knitr::opts_knit$set(root.dir = wd)
# relative directories
robj<-"r_objects"
fig<-"../../figures"
gis_data<-"../../data/gis_data"
output<-"../../output"
data_d<-"../../data"
cor_d<-"../../data/argo/coriolis_dac"
my_functions<-"r_scripts/submodules/BG_functions/"
# ocean_color<-"../../data/ocean_color_bud"
# bathy_d<-"../../data/bathy" # edit this
# olaf_profiles



knitr::opts_chunk$set(echo =FALSE)
#knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

# source
```{r}
source(paste0(my_functions, "ch2_functions.R"))
source(paste0(my_functions, "ch2_header.R"))
source(paste0(my_functions, "final_functions.R"))


f.ipak(packages)
rm(i)
## get metadata ##
# initialize_argo()

```
# load data for plottng final

```{r}
data<-readRDS("r_objects/omz_change_whole_day.R")
temp<-readRDS("r_objects/ch2_seq_1_data.R")
h.pts<-temp$selected_zone_hurdat$h.pts
rm(temp)

```

```{r}
df<-data%>%bind_rows(.id = "group")
df<-f.match_tc_omz_change(h.pts, df)

df<-filter(df, omz_value <= 500) # error or real?
df.after<-filter(df, day_difference >=0)
```

# filter # 1

```{r}
x<-filter(df, distance_m <=200000)
```


## anova
```{r}
one.way_df<-aov(omz_p ~ day_difference, data = df)
one.way_df.after<-aov(omz_p ~ day_difference, data =df.after)
two.way_df<-aov(omz_p ~ day_difference + distance_m, data = df)
two.way_df.after<-aov(omz_p ~ day_difference + distance_m, data = df.after)

three.way_df<-aov(omz_p ~ day_difference + distance_m + Wind, data = df)
three.way_df.after<-aov(omz_p ~ day_difference + distance_m + Wind, data = df.after)

three.way_x<-aov(omz_p ~ day_difference + distance_m + Wind, data = x)

y1<-sample_n(x, dim(x)[1]-100)
y2<-sample_n(x, dim(x)[1]-200)
y3<-sample_n(x, dim(x)[1]-500)

three.way_y1<-aov(omz_p ~ day_difference + distance_m + Wind, data = x)
three.way_y2<-aov(omz_p ~ day_difference + distance_m + Wind, data = x)
three.way_y3<-aov(omz_p ~ day_difference + distance_m + Wind, data = x)

four.way_df<-aov(omz_p ~ day_difference + distance_m + Wind +Key, data=df)
four.way_df.after<-aov(omz_p ~ day_difference + distance_m + Wind +Key, data=df.after)


five.way_df<-aov(omz_p ~ day_difference + distance_m + Wind +Key +Status, data=df)
five.way_df.after<-aov(omz_p ~ day_difference + distance_m + Wind +Key+Status, data=df.after)


```


```{r}
summary(three.way_x)
summary(three.way_y1)
summary(three.way_y2)
summary(three.way_y3)

summary(four.way_df)

summary(four.way_df.after)

```

```{r}

summary(five.way_df)

summary(five.way_df.after)


```








# load data for omz calcultion

```{r}
data<-readRDS("r_objects/selected_profiles_list.R")

```

```{r}
z<-data[[87]]


t87<-f.final_match_v3(z)

```


```{r}
rm(z, t87)
```



```{r}

t1<-vector(mode = "list", length=length(data))
for(i in 1:length(data)){
t1[[i]]<-f.final_match_v2(data[[i]])
  
}


```


## try
```{r}
# omz_change_decimal_day<-lapply(data, f.final_match_v2)
omz_change_whole_day<-lapply(data, f.final_match_v3)


```


```{r}
setwd(wd)
saveRDS(omz_change_whole_day, "r_objects/omz_change_whole_day.R")
```





#data split_lists
```{r}

data<-readRDS("r_objects/ch2_seq_1_data.R")
all<-data$tc_search_radi_profiles$km_500$tc
rm(data)


x<-lapply(all, f.remove)
x<-purrr::list_flatten(x)
rm(all)

```



```{r}
Sys.time()
print(Sys.time())
selected_profiles_list<-lapply(x, f.get_profiles)
# saveRDS(selected_profiles_list, "r_objects/olaf_match.R")
Sys.time()
print(Sys.time())
```

```{r}
# saveRDS(selected_profiles_list, "r_objects/selected_profiles_list.R")
test<-readRDS("r_objects/selected_profiles_list.R")

```



```{r}
omz_change<-lapply(x, f.final_match)
saveRDS(omz_change, "r_objects/olaf_match.R")
Sys.time()
print(Sys.time())

```






















